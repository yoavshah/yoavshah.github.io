<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.125.3">

    

    

    
        
            <meta
                name="description"
                content="This is my new hugo site" />
        

        
            <meta
                name="keywords"
                content="security,cryptohack,writeups,cyber" />
        

        
            <meta
                name="author"
                content="yoavshah" />
        

    


    <title>
        
            10-logon_zero |
            SecurityBlog
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
        


        
        


        <link
            rel="stylesheet"
            href="/css/index_d751713.min.912d03bce61461ecbc3ca083479e1ed814bba94df76d0bdc6aa88fdca33621b9bb410dc2c81af31e8101fec62decfa5f6e48901ad673bc5056d2f1d1f2368a34.css"
            integrity="sha512-kS0DvOYUYey8PKCDR54e2BS7qU33bQvcaqiP3KM2Ibm7QQ3CyBrzHoEB/sYt7PpfbkiQGtZzvFBW0vHR8jaKNA==" />
    


    
    

    

    

    


    
		
        

            




    
        
    




<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
    crossorigin="anonymous" />


<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
    crossorigin="anonymous"></script>


<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
    crossorigin="anonymous"
    
        onload="renderMathInElement(document.body , { trust: true });"
    ></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            
            
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true },
            ],
            
            throwOnError: false,

            
                trust: true
            
        });
    });
</script>

        

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            10-logon_zero -
            SecurityBlog
        
    </div>
</header>



        <main>
            <aside class="sidebar" style="overflow-y: auto;">
    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> Cryptohack </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> diffie-helman </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/0-diffie_hellman_explained/" title="./cryptohack/diffie-hellman/0-diffie_hellman_explained/">
                        
                            0-diffie_hellman_explained
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/1-parameter_injection/" title="./cryptohack/diffie-hellman/1-parameter_injection/">
                        
                            1-parameter_injection
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/2-export-grade/" title="./cryptohack/diffie-hellman/2-export-grade/">
                        
                            2-export_grade
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> hashes </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/1-collider/" title="./cryptohack/hashes/1-collider/">
                        
                            1-collider
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/2-hash_stuffing/" title="./cryptohack/hashes/2-hash_stuffing/">
                        
                            2-hash_stuffing
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/3-primed5/" title="./cryptohack/hashes/3-primed5/">
                        
                            3-PriMeD5
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/4-twin_keys/" title="./cryptohack/hashes/4-twin_keys/">
                        
                            4-twin_keys
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/5-no_difference/" title="./cryptohack/hashes/5-no_difference/">
                        
                            5-no_difference
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/6-md0/" title="./cryptohack/hashes/6-md0/">
                        
                            6-md0
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/7-mdflag/" title="./cryptohack/hashes/7-mdflag/">
                        
                            7-mdflag
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/8-mixed_up/" title="./cryptohack/hashes/8-mixed_up/">
                        
                            8-mixed_up
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/9-invariant/" title="./cryptohack/hashes/9-invariant/">
                        
                            9-invariant
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> symmetric </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/01-passwords_as_keys/" title="./cryptohack/symmetric/01-passwords_as_keys/">
                        
                            01-passwords_as_keys
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/02-ecbcbcwtf/" title="./cryptohack/symmetric/02-ecbcbcwtf/">
                        
                            02-ecbcbcwtf
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/03-ecb_oracle/" title="./cryptohack/symmetric/03-ecb_oracle/">
                        
                            03-ecb_oracle
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/04-flipping_cookie/" title="./cryptohack/symmetric/04-flipping_cookie/">
                        
                            04-flipping_cookie
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/05-lazy_cbc/" title="./cryptohack/symmetric/05-lazy_cbc/">
                        
                            05-lazy_cbc
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/06-triple_des/" title="./cryptohack/symmetric/06-triple_des/">
                        
                            06-triple_des
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/07-symmetry/" title="./cryptohack/symmetric/07-symmetry/">
                        
                            07-symmetry
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/08-bean_counter/" title="./cryptohack/symmetric/08-bean_counter/">
                        
                            08-bean_counter
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/09-ctrime/" title="./cryptohack/symmetric/09-ctrime/">
                        
                            09-ctrime
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/10-logon_zero/" title="./cryptohack/symmetric/10-logon_zero/">
                        
                            10-logon_zero
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/11-stream_consciousness/" title="./cryptohack/symmetric/11-stream_consciousness/">
                        
                            11-stream_consciousness
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/12-dancing_queen/" title="./cryptohack/symmetric/12-dancing_queen/">
                        
                            12-dancing_queen
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/13-oh-snap/" title="./cryptohack/symmetric/13-oh-snap/">
                        
                            13-oh-snap
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/14-paper_plane/" title="./cryptohack/symmetric/14-paper_plane/">
                        
                            14-paper_plane
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/15-forbidden_fruit/" title="./cryptohack/symmetric/15-forbidden_fruit/">
                        
                            15-forbidden_fruit
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/16-beatboxer/" title="./cryptohack/symmetric/16-beatboxer/">
                        
                            16-beatboxer
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                10-logon_zero
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/yoavshah/"
                                class="cat-btn">
                                yoavshah
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="2024.04.26"
                            >2024.04.26
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        5 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    
    
    




<a href="https://yoavshah.github.io/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="https://yoavshah.github.io/cryptohack/" class="bread-btn">
    

    
        Cryptohack
    
</a>




    /



<a href="https://yoavshah.github.io/cryptohack/symmetric/" class="bread-btn">
    

    
        symmetric
    
</a>




    /



<a href="https://yoavshah.github.io/cryptohack/symmetric/10-logon_zero/" class="bread-btn">
    

    
        
            10-logon_zero
        

    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents"></nav>
        


        <div class="content">
            
                <h1 id="challenge">Challenge</h1>
<p>In this challenge we get a remote server with a code call 13399.py</p>
<p>The remote server support 3 method</p>
<ul>
<li>authenticate - if the password we sent equals to the password of the challenge we ge tthe flag</li>
<li>reset_connection - create a new CFB8 cipher with random input</li>
<li>reset_password - it decrypt the token and get a size from the last 4 bytes, then creates a random password in that length</li>
</ul>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#!/usr/bin/env%20python3%0d%0a%0d%0afrom%20Crypto.Cipher%20import%20AES%0d%0afrom%20Crypto.Util.number%20import%20bytes_to_long%0d%0afrom%20os%20import%20urandom%0d%0a%0d%0aFLAG%20=%20%22crypto%7b???????????????????????????????%7d%22%0d%0a%0d%0a%0d%0aclass%20CFB8:%0d%0a%20%20%20%20def%20__init__%28self,%20key%29:%0d%0a%20%20%20%20%20%20%20%20self.key%20=%20key%0d%0a%0d%0a%20%20%20%20def%20encrypt%28self,%20plaintext%29:%0d%0a%20%20%20%20%20%20%20%20IV%20=%20urandom%2816%29%0d%0a%20%20%20%20%20%20%20%20cipher%20=%20AES.new%28self.key,%20AES.MODE_ECB%29%0d%0a%20%20%20%20%20%20%20%20ct%20=%20b%27%27%0d%0a%20%20%20%20%20%20%20%20state%20=%20IV%0d%0a%20%20%20%20%20%20%20%20for%20i%20in%20range%28len%28plaintext%29%29:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20b%20=%20cipher.encrypt%28state%29[0]%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20c%20=%20b%20%5e%20plaintext[i]%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20ct%20&#43;=%20bytes%28[c]%29%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20state%20=%20state[1:]%20&#43;%20bytes%28[c]%29%0d%0a%20%20%20%20%20%20%20%20return%20IV%20&#43;%20ct%0d%0a%0d%0a%20%20%20%20def%20decrypt%28self,%20ciphertext%29:%0d%0a%20%20%20%20%20%20%20%20IV%20=%20ciphertext[:16]%0d%0a%20%20%20%20%20%20%20%20ct%20=%20ciphertext[16:]%0d%0a%20%20%20%20%20%20%20%20cipher%20=%20AES.new%28self.key,%20AES.MODE_ECB%29%0d%0a%20%20%20%20%20%20%20%20pt%20=%20b%27%27%0d%0a%20%20%20%20%20%20%20%20state%20=%20IV%0d%0a%20%20%20%20%20%20%20%20for%20i%20in%20range%28len%28ct%29%29:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20b%20=%20cipher.encrypt%28state%29[0]%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20c%20=%20b%20%5e%20ct[i]%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20pt%20&#43;=%20bytes%28[c]%29%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20state%20=%20state[1:]%20&#43;%20bytes%28[ct[i]]%29%0d%0a%20%20%20%20%20%20%20%20return%20pt%0d%0a%0d%0a%0d%0aclass%20Challenge%28%29:%0d%0a%20%20%20%20def%20__init__%28self%29:%0d%0a%20%20%20%20%20%20%20%20self.before_input%20=%20%22Please%20authenticate%20to%20this%20Domain%20Controller%20to%20proceed%5cn%22%0d%0a%20%20%20%20%20%20%20%20self.password%20=%20urandom%2820%29%0d%0a%20%20%20%20%20%20%20%20self.password_length%20=%20len%28self.password%29%0d%0a%20%20%20%20%20%20%20%20self.cipher%20=%20CFB8%28urandom%2816%29%29%0d%0a%0d%0a%20%20%20%20def%20challenge%28self,%20your_input%29:%0d%0a%20%20%20%20%20%20%20%20if%20your_input[%27option%27]%20==%20%27authenticate%27:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20if%20%27password%27%20not%20in%20your_input:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7b%27msg%27:%20%27No%20password%20provided.%27%7d%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20your_password%20=%20your_input[%27password%27]%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20if%20your_password.encode%28%29%20==%20self.password:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.exit%20=%20True%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7b%27msg%27:%20%27Welcome%20admin,%20flag:%20%27%20&#43;%20FLAG%7d%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20else:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7b%27msg%27:%20%27Wrong%20password.%27%7d%0d%0a%0d%0a%20%20%20%20%20%20%20%20if%20your_input[%27option%27]%20==%20%27reset_connection%27:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20self.cipher%20=%20CFB8%28urandom%2816%29%29%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20return%20%7b%27msg%27:%20%27Connection%20has%20been%20reset.%27%7d%0d%0a%0d%0a%20%20%20%20%20%20%20%20if%20your_input[%27option%27]%20==%20%27reset_password%27:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20if%20%27token%27%20not%20in%20your_input:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7b%27msg%27:%20%27No%20token%20provided.%27%7d%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20token_ct%20=%20bytes.fromhex%28your_input[%27token%27]%29%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20if%20len%28token_ct%29%20%3c%2028:%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7b%27msg%27:%20%27New%20password%20should%20be%20at%20least%208-characters%20long.%27%7d%0d%0a%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20token%20=%20self.cipher.decrypt%28token_ct%29%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20new_password%20=%20token[:-4]%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20self.password_length%20=%20bytes_to_long%28token[-4:]%29%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20self.password%20=%20new_password[:self.password_length]%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20return%20%7b%27msg%27:%20%27Password%20has%20been%20correctly%20reset.%27%7d%0d%0a%0d%0a%0d%0apassword%20=%20urandom%2820%29%0d%0apassword_length%20=%20len%28password%29%0d%0acipher%20=%20CFB8%28urandom%2816%29%29">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> bytes_to_long
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> os <span style="color:#f92672">import</span> urandom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;crypto{???????????????????????????????}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CFB8</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, key):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>key <span style="color:#f92672">=</span> key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encrypt</span>(self, plaintext):
</span></span><span style="display:flex;"><span>        IV <span style="color:#f92672">=</span> urandom(<span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>        cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(self<span style="color:#f92672">.</span>key, AES<span style="color:#f92672">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>        ct <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        state <span style="color:#f92672">=</span> IV
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(plaintext)):
</span></span><span style="display:flex;"><span>            b <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>encrypt(state)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            c <span style="color:#f92672">=</span> b <span style="color:#f92672">^</span> plaintext[i]
</span></span><span style="display:flex;"><span>            ct <span style="color:#f92672">+=</span> bytes([c])
</span></span><span style="display:flex;"><span>            state <span style="color:#f92672">=</span> state[<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">+</span> bytes([c])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> IV <span style="color:#f92672">+</span> ct
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt</span>(self, ciphertext):
</span></span><span style="display:flex;"><span>        IV <span style="color:#f92672">=</span> ciphertext[:<span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span>        ct <span style="color:#f92672">=</span> ciphertext[<span style="color:#ae81ff">16</span>:]
</span></span><span style="display:flex;"><span>        cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(self<span style="color:#f92672">.</span>key, AES<span style="color:#f92672">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>        pt <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        state <span style="color:#f92672">=</span> IV
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(ct)):
</span></span><span style="display:flex;"><span>            b <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>encrypt(state)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            c <span style="color:#f92672">=</span> b <span style="color:#f92672">^</span> ct[i]
</span></span><span style="display:flex;"><span>            pt <span style="color:#f92672">+=</span> bytes([c])
</span></span><span style="display:flex;"><span>            state <span style="color:#f92672">=</span> state[<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">+</span> bytes([ct[i]])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> pt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Challenge</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>before_input <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Please authenticate to this Domain Controller to proceed</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>password <span style="color:#f92672">=</span> urandom(<span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>password_length <span style="color:#f92672">=</span> len(self<span style="color:#f92672">.</span>password)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cipher <span style="color:#f92672">=</span> CFB8(urandom(<span style="color:#ae81ff">16</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">challenge</span>(self, your_input):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> your_input[<span style="color:#e6db74">&#39;option&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;authenticate&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> your_input:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;No password provided.&#39;</span>}
</span></span><span style="display:flex;"><span>            your_password <span style="color:#f92672">=</span> your_input[<span style="color:#e6db74">&#39;password&#39;</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> your_password<span style="color:#f92672">.</span>encode() <span style="color:#f92672">==</span> self<span style="color:#f92672">.</span>password:
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>exit <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;Welcome admin, flag: &#39;</span> <span style="color:#f92672">+</span> FLAG}
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;Wrong password.&#39;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> your_input[<span style="color:#e6db74">&#39;option&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;reset_connection&#39;</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>cipher <span style="color:#f92672">=</span> CFB8(urandom(<span style="color:#ae81ff">16</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;Connection has been reset.&#39;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> your_input[<span style="color:#e6db74">&#39;option&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;reset_password&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;token&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> your_input:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;No token provided.&#39;</span>}
</span></span><span style="display:flex;"><span>            token_ct <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(your_input[<span style="color:#e6db74">&#39;token&#39;</span>])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> len(token_ct) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">28</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;New password should be at least 8-characters long.&#39;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            token <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cipher<span style="color:#f92672">.</span>decrypt(token_ct)
</span></span><span style="display:flex;"><span>            new_password <span style="color:#f92672">=</span> token[:<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>password_length <span style="color:#f92672">=</span> bytes_to_long(token[<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>:])
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>password <span style="color:#f92672">=</span> new_password[:self<span style="color:#f92672">.</span>password_length]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;Password has been correctly reset.&#39;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>password <span style="color:#f92672">=</span> urandom(<span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>password_length <span style="color:#f92672">=</span> len(password)
</span></span><span style="display:flex;"><span>cipher <span style="color:#f92672">=</span> CFB8(urandom(<span style="color:#ae81ff">16</span>))</span></span></code></pre></div>
    
</div>
<h1 id="solution">Solution</h1>
<p>The problem in the code is that after using reset_password option the password new length can be 0 in case the last 4 bytes of the decrypted token will be 0, this will result in the password equals to empty string.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> your_input[<span style="color:#e6db74">&#39;option&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;reset_password&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;token&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> your_input:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;No token provided.&#39;</span>}
</span></span><span style="display:flex;"><span>            token_ct <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(your_input[<span style="color:#e6db74">&#39;token&#39;</span>])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> len(token_ct) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">28</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;New password should be at least 8-characters long.&#39;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            token <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cipher<span style="color:#f92672">.</span>decrypt(token_ct)
</span></span><span style="display:flex;"><span>            new_password <span style="color:#f92672">=</span> token[:<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>password_length <span style="color:#f92672">=</span> bytes_to_long(token[<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>:])
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>password <span style="color:#f92672">=</span> new_password[:self<span style="color:#f92672">.</span>password_length]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;msg&#39;</span>: <span style="color:#e6db74">&#39;Password has been correctly reset.&#39;</span>}</span></span></code></pre></div>
    
</div>
<p>The new password is created from the decrypted token and the token is being decrypted using the cipher CFB8, lets have a look on that cipher.</p>
<p>in the cipher decryption routine we can see that it seperate the input to IV and ct, we control both, then it tries to encrypt the IV using ECB mode and xor the first byte from the encrypted IV with the current ct.
After that it concat the current ct to the state and saves to the output the xord byte.</p>
<p>Because we control the ct and the IV, we can set them both to be the same values resulting in the state to stay constant so the encrypt(state)[0] will also return the same byte each iteration</p>
<p>Because the variables b and ct[i] contain the same value in each iteration pt[i] will be the same value, and this value will be affected based on the key!</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt</span>(self, ciphertext):
</span></span><span style="display:flex;"><span>        IV <span style="color:#f92672">=</span> ciphertext[:<span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span>        ct <span style="color:#f92672">=</span> ciphertext[<span style="color:#ae81ff">16</span>:]
</span></span><span style="display:flex;"><span>        cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(self<span style="color:#f92672">.</span>key, AES<span style="color:#f92672">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>        pt <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        state <span style="color:#f92672">=</span> IV
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(ct)):
</span></span><span style="display:flex;"><span>            b <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>encrypt(state)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            c <span style="color:#f92672">=</span> b <span style="color:#f92672">^</span> ct[i]
</span></span><span style="display:flex;"><span>            pt <span style="color:#f92672">+=</span> bytes([c])
</span></span><span style="display:flex;"><span>            state <span style="color:#f92672">=</span> state[<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">+</span> bytes([ct[i]])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> pt</span></span></code></pre></div>
    
</div>
<p>Because pt[i] will be the same for each i, then the decrypted token will have only 16 possible values! and if the value is 0 the 4 last bytes will be also 0 which mean the reset_password option will reset the password to an empty string!</p>
<p>Okay, so now we can try to reset the password and hope that the new password will be an empty string, and we got 1/16 chance of winning.
But how can we make a way that will cause the server to change the output value in case we didn&rsquo;t succeed?</p>
<p>We can just use the reset_connection option which will randomize the key in the class! therefore letting us looping forever until we win the challenge and the flag (in each iteration we have 1/16 win change which is not a little)</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span> <span style="color:#75715e"># pip install pwntools</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> codecs
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> Crypto.Util.number
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;socket.cryptohack.org&#39;</span>, <span style="color:#ae81ff">13399</span>, level <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;debug&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">recv</span>():
</span></span><span style="display:flex;"><span>    line <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> line
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">recvjson</span>():
</span></span><span style="display:flex;"><span>    line <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(r<span style="color:#f92672">.</span>recvline()<span style="color:#f92672">.</span>decode())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> line
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sendjson</span>(hsh):
</span></span><span style="display:flex;"><span>    request <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps(hsh)<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>    r<span style="color:#f92672">.</span>sendline(request)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>received <span style="color:#f92672">=</span> recv()
</span></span><span style="display:flex;"><span>print(received)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    found <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0xFF</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        pad <span style="color:#f92672">=</span> i<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>)<span style="color:#f92672">.</span>hex()
</span></span><span style="display:flex;"><span>        sendjson({<span style="color:#e6db74">&#34;option&#34;</span>: <span style="color:#e6db74">&#34;reset_password&#34;</span>, <span style="color:#e6db74">&#34;token&#34;</span>: pad<span style="color:#f92672">*</span><span style="color:#ae81ff">32</span> <span style="color:#f92672">+</span> pad<span style="color:#f92672">*</span><span style="color:#ae81ff">64</span>})
</span></span><span style="display:flex;"><span>        recv <span style="color:#f92672">=</span> recvjson()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> recv[<span style="color:#e6db74">&#34;msg&#34;</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;Password has been correctly reset.&#34;</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;BAD&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sendjson({<span style="color:#e6db74">&#34;option&#34;</span>: <span style="color:#e6db74">&#34;authenticate&#34;</span>, <span style="color:#e6db74">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>})
</span></span><span style="display:flex;"><span>        recv <span style="color:#f92672">=</span> recvjson()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Welcome admin&#34;</span> <span style="color:#f92672">in</span> recv[<span style="color:#e6db74">&#34;msg&#34;</span>]:
</span></span><span style="display:flex;"><span>            print(recv[<span style="color:#e6db74">&#34;msg&#34;</span>])
</span></span><span style="display:flex;"><span>            found <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> found:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    sendjson({<span style="color:#e6db74">&#34;option&#34;</span>: <span style="color:#e6db74">&#34;reset_connection&#34;</span>})
</span></span><span style="display:flex;"><span>    recv <span style="color:#f92672">=</span> recvjson()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> recv[<span style="color:#e6db74">&#34;msg&#34;</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;Connection has been reset.&#34;</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;BAD&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>close()</span></span></code></pre></div>
    
</div>
<p><a href="/cryptohack/symmetric/code/logon_zero.py">logon_zero.py</a></p>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>All Rights Reserved Â®.</li>
            

            
                <li>yoavshah</li>
            

            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            
                <li>
                    
                        Word Count:
                        853
                    
                </li>
            

            
            

            
                <li>en</li>
            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.125.3</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Apr 26 2024 10:59:55
                        </time>
                    
                </li>
            

            
                <li title="">
                    
                </li>
            
        </ul>
    </div>
</footer>

    </body>

    























    
    


    
    


    <script
        type="text/javascript"
        src="/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js"
        integrity="sha512-XusSDxbqFGNSclxCA2T4e&#43;/q1F9ngUK48P&#43;&#43;8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script>














<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
