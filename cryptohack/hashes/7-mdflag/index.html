<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.125.3">

    

    

    
        
            <meta
                name="description"
                content="This is my new hugo site" />
        

        
            <meta
                name="keywords"
                content="security,cryptohack,writeups,cyber" />
        

        
            <meta
                name="author"
                content="yoavshah" />
        

    


    <title>
        
            7-mdflag |
            SecurityBlog
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
        


        
        


        <link
            rel="stylesheet"
            href="/css/index_d751713.min.912d03bce61461ecbc3ca083479e1ed814bba94df76d0bdc6aa88fdca33621b9bb410dc2c81af31e8101fec62decfa5f6e48901ad673bc5056d2f1d1f2368a34.css"
            integrity="sha512-kS0DvOYUYey8PKCDR54e2BS7qU33bQvcaqiP3KM2Ibm7QQ3CyBrzHoEB/sYt7PpfbkiQGtZzvFBW0vHR8jaKNA==" />
    


    
    

    

    

    


    
		
        

            




    
        
    




<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
    crossorigin="anonymous" />


<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
    crossorigin="anonymous"></script>


<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
    crossorigin="anonymous"
    
        onload="renderMathInElement(document.body , { trust: true });"
    ></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            
            
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true },
            ],
            
            throwOnError: false,

            
                trust: true
            
        });
    });
</script>

        

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            7-mdflag -
            SecurityBlog
        
    </div>
</header>



        <main>
            <aside class="sidebar" style="overflow-y: auto;">
    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Blockchain </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> smart-contracts-development </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/blockchain/development/0-setting_up_environment/" title="./blockchain/development/0-setting_up_environment/">
                        
                            0-setting_up_environment
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/blockchain/development/1-kingofthehill/" title="./blockchain/development/1-kingofthehill/">
                        
                            1-KingOfTheHill
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> ethernaut </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/blockchain/ethernaut/0-setting_up_environment/" title="./blockchain/ethernaut/0-setting_up_environment/">
                        
                            0-setting_up_environment
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/blockchain/ethernaut/1-fallback/" title="./blockchain/ethernaut/1-fallback/">
                        
                            1-fallback
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> Cryptohack </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> diffie-helman </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/0-diffie_hellman_explained/" title="./cryptohack/diffie-hellman/0-diffie_hellman_explained/">
                        
                            0-diffie_hellman_explained
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/1-parameter_injection/" title="./cryptohack/diffie-hellman/1-parameter_injection/">
                        
                            1-parameter_injection
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/2-export_grade/" title="./cryptohack/diffie-hellman/2-export_grade/">
                        
                            2-export_grade
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/3-static_client/" title="./cryptohack/diffie-hellman/3-static_client/">
                        
                            3-static_client
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/4-additive/" title="./cryptohack/diffie-hellman/4-additive/">
                        
                            4-additive
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/5-static_client_2/" title="./cryptohack/diffie-hellman/5-static_client_2/">
                        
                            5-static_client_2
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/6-script_kiddie/" title="./cryptohack/diffie-hellman/6-script_kiddie/">
                        
                            6-script_kiddie
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/7-the_matrix/" title="./cryptohack/diffie-hellman/7-the_matrix/">
                        
                            7-the_matrix
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/8-the_matrix_reloaded/" title="./cryptohack/diffie-hellman/8-the_matrix_reloaded/">
                        
                            8-the_matrix_reloaded
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/diffie-hellman/9-the_matrix_revolutions/" title="./cryptohack/diffie-hellman/9-the_matrix_revolutions/">
                        
                            9-the_matrix_revolutions
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> hashes </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/1-collider/" title="./cryptohack/hashes/1-collider/">
                        
                            1-collider
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/2-hash_stuffing/" title="./cryptohack/hashes/2-hash_stuffing/">
                        
                            2-hash_stuffing
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/3-primed5/" title="./cryptohack/hashes/3-primed5/">
                        
                            3-PriMeD5
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/4-twin_keys/" title="./cryptohack/hashes/4-twin_keys/">
                        
                            4-twin_keys
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/5-no_difference/" title="./cryptohack/hashes/5-no_difference/">
                        
                            5-no_difference
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/6-md0/" title="./cryptohack/hashes/6-md0/">
                        
                            6-md0
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/7-mdflag/" title="./cryptohack/hashes/7-mdflag/">
                        
                            7-mdflag
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/8-mixed_up/" title="./cryptohack/hashes/8-mixed_up/">
                        
                            8-mixed_up
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/9-invariant/" title="./cryptohack/hashes/9-invariant/">
                        
                            9-invariant
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> rsa </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/rsa/0-rsa_explained/" title="./cryptohack/rsa/0-rsa_explained/">
                        
                            0-rsa_explained
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> symmetric </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/01-passwords_as_keys/" title="./cryptohack/symmetric/01-passwords_as_keys/">
                        
                            01-passwords_as_keys
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/02-ecbcbcwtf/" title="./cryptohack/symmetric/02-ecbcbcwtf/">
                        
                            02-ecbcbcwtf
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/03-ecb_oracle/" title="./cryptohack/symmetric/03-ecb_oracle/">
                        
                            03-ecb_oracle
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/04-flipping_cookie/" title="./cryptohack/symmetric/04-flipping_cookie/">
                        
                            04-flipping_cookie
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/05-lazy_cbc/" title="./cryptohack/symmetric/05-lazy_cbc/">
                        
                            05-lazy_cbc
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/06-triple_des/" title="./cryptohack/symmetric/06-triple_des/">
                        
                            06-triple_des
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/07-symmetry/" title="./cryptohack/symmetric/07-symmetry/">
                        
                            07-symmetry
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/08-bean_counter/" title="./cryptohack/symmetric/08-bean_counter/">
                        
                            08-bean_counter
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/09-ctrime/" title="./cryptohack/symmetric/09-ctrime/">
                        
                            09-ctrime
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/10-logon_zero/" title="./cryptohack/symmetric/10-logon_zero/">
                        
                            10-logon_zero
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/11-stream_consciousness/" title="./cryptohack/symmetric/11-stream_consciousness/">
                        
                            11-stream_consciousness
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/12-dancing_queen/" title="./cryptohack/symmetric/12-dancing_queen/">
                        
                            12-dancing_queen
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/13-oh-snap/" title="./cryptohack/symmetric/13-oh-snap/">
                        
                            13-oh-snap
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/14-paper_plane/" title="./cryptohack/symmetric/14-paper_plane/">
                        
                            14-paper_plane
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/15-forbidden_fruit/" title="./cryptohack/symmetric/15-forbidden_fruit/">
                        
                            15-forbidden_fruit
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/16-beatboxer/" title="./cryptohack/symmetric/16-beatboxer/">
                        
                            16-beatboxer
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Windows </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Kernel </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/windows/kernel/readwrite_using_dbutil_2_3/" title="./windows/kernel/readwrite_using_dbutil_2_3/">
                        
                            Read/Write using dbutil_2_3
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/windows/kernel/reverse_dbutil_2_3/" title="./windows/kernel/reverse_dbutil_2_3/">
                        
                            Reverse dbutil_2_3
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/windows/kernel/reverse_rtcore64/" title="./windows/kernel/reverse_rtcore64/">
                        
                            Reverse RTCore64
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Portable-Executable </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/windows/portable-executable/fileinfector/" title="./windows/portable-executable/fileinfector/">
                        
                            FileInfector
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                7-mdflag
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/yoavshah/"
                                class="cat-btn">
                                yoavshah
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="2024.05.10"
                            >2024.05.10
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        9 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    
    
    




<a href="https://yoavshah.github.io/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="https://yoavshah.github.io/cryptohack/" class="bread-btn">
    

    
        Cryptohack
    
</a>




    /



<a href="https://yoavshah.github.io/cryptohack/hashes/" class="bread-btn">
    

    
        hashes
    
</a>




    /



<a href="https://yoavshah.github.io/cryptohack/hashes/7-mdflag/" class="bread-btn">
    

    
        
            7-mdflag
        

    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents"></nav>
        


        <div class="content">
            
                <h1 id="challenge">Challenge</h1>
<p>In this challenge we get a program that have only one option and it is to get data, then xor it together with the flag (cycle - so we can enter more bytes that the flag), the use MD5 on it.
We need to somehow get the flag.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> itertools <span style="color:#f92672">import</span> cycle
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> md5
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> utils <span style="color:#f92672">import</span> listener
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;crypto{??????????????????????????????????????}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">bxor</span>(a, b):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> bytes(x <span style="color:#f92672">^</span> y <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(a, b))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Challenge</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>before_input <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter data</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">challenge</span>(self, msg):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;option&#34;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> msg:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;You must send an option to this server.&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> msg[<span style="color:#e6db74">&#34;option&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;message&#34;</span>:
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(msg[<span style="color:#e6db74">&#34;data&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> len(data) <span style="color:#f92672">&lt;</span> len(FLAG):
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;Bad input&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            salted <span style="color:#f92672">=</span> bxor(data, cycle(FLAG))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;hash&#34;</span>: md5(salted)<span style="color:#f92672">.</span>hexdigest()}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;Invalid option&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">When you connect, the &#39;challenge&#39; function will be called on your JSON
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">input.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>listener<span style="color:#f92672">.</span>start_server(port<span style="color:#f92672">=</span><span style="color:#ae81ff">13407</span>)</span></span></code></pre></div>
    
</div>
<h1 id="solution">Solution</h1>
<p>In this challenge we first need to understand how MD5 works and change its functionality.
I used the <a href="https://github.com/Utkarsh87/md5-hashing/blob/master/md5.py">following project</a>.</p>
<p>First we need to get the flag length from the program, that&rsquo;s actualy easy because whenever we give input smaller than the flag we get error.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>r <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;socket.cryptohack.org&#39;</span>, <span style="color:#ae81ff">13407</span>, level <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;debug&#39;</span>)
</span></span><span style="display:flex;"><span>_ <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>flag_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    json_send(r, {<span style="color:#e6db74">&#34;option&#34;</span>: <span style="color:#e6db74">&#34;message&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>: (<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">*</span>flag_size)<span style="color:#f92672">.</span>hex()})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> json_recv(r)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;error&#34;</span> <span style="color:#f92672">in</span> res <span style="color:#f92672">and</span> res[<span style="color:#e6db74">&#34;error&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Bad input&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    flag_size <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>close()</span></span></code></pre></div>
    
</div>
<p>We found that the flag size is 46 bytes.</p>
<p>We know that MD5 is using <a href="https://en.wikipedia.org/wiki/Merkle%E2%80%93Damg%C3%A5rd_construction">Merkle–Damgård construction</a> so that if</p>
<p>$$
S_1 = H(M_a)
$$</p>
<p>$$
S_2 = H(M_a + M_b) = H(S_1, M_b)
$$</p>
<p>So using the hash $S_1$ we can calculate $S_2$.
The problem is that MD5 add padding&hellip;</p>
<p>The padding function of <a href="https://github.com/Utkarsh87/md5-hashing/blob/master/md5.py#L16">MD5 works that way</a>.
Append 0x80 to the last block, then append zeros until there are 8 bytes left in the block, then add the size of the input (in bits) as the last 8 bytes.</p>
<p>Because of that we can create an input that the last 9 bytes of the state will be known
$$
(0x80, L)
$$</p>
<p>Because the flag size is 46 and each block of MD5 is 64, we can print for each block what it will be xored with.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;crypto{&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">38</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> FLAG<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>FLAG_LENGTH <span style="color:#f92672">=</span> len(FLAG)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_block</span>(data, block_size, block_index):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cyc <span style="color:#f92672">=</span> cycle(data)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(block_index <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(block_size):
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">+=</span> cyc<span style="color:#f92672">.</span>__next__()<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(generate_block(FLAG, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>print(generate_block(FLAG, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>print(generate_block(FLAG, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>print(generate_block(FLAG, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>print(generate_block(FLAG, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>print(generate_block(FLAG, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>print(generate_block(FLAG, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>print(generate_block(FLAG, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">7</span>))</span></span></code></pre></div>
    
</div>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="b%27crypto%7b______________________________________%7dcrypto%7b___________%27%0d%0ab%27___________________________%7dcrypto%7b_____________________________%27%0d%0ab%27_________%7dcrypto%7b______________________________________%7dcrypto%7b_%27%0d%0ab%27_____________________________________%7dcrypto%7b___________________%27%0d%0ab%27___________________%7dcrypto%7b_____________________________________%27%0d%0ab%27_%7dcrypto%7b______________________________________%7dcrypto%7b_________%27%0d%0ab%27_____________________________%7dcrypto%7b___________________________%27%0d%0ab%27___________%7dcrypto%7b______________________________________%7dcrypto%27">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>b&#39;crypto{______________________________________}crypto{___________&#39;
b&#39;___________________________}crypto{_____________________________&#39;
b&#39;_________}crypto{______________________________________}crypto{_&#39;
b&#39;_____________________________________}crypto{___________________&#39;
b&#39;___________________}crypto{_____________________________________&#39;
b&#39;_}crypto{______________________________________}crypto{_________&#39;
b&#39;_____________________________}crypto{___________________________&#39;
b&#39;___________}crypto{______________________________________}crypto&#39;</code></pre>
    
</div>
<p>Let&rsquo;s have a look at the second block</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="b%27_________%7dcrypto%7b______________________________________%7dcrypto%7b_%27">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>b&#39;_________}crypto{______________________________________}crypto{_&#39;</code></pre>
    
</div>
<p>We can see that from the last 9 bytes of the block we know 8 for sure exists in the flag (&quot;}crypto{_&quot;), so we can actually bruteforce the last character!</p>
<p>First let&rsquo;s create 2 blocks of zeros and another 55 bytes of zeros, so the padding in the MD5 hashing algorithm will pad it with specific data we know.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000%0d%0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000%0d%0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</code></pre>
    
</div>
<p>This message will be padded to the following message</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000%0d%0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000%0d%0a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080b805000000000000">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080b805000000000000</code></pre>
    
</div>
<p>The program will xor the whole data (without the padded suffix), so we will get (where XX is an unknown value, we know some values of the flag because it starts with &ldquo;crypto{&rdquo; and ends with &ldquo;}&rdquo;)</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="63727970746f7bXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX7d63727970746f7bXXXXXXXXXXXXXXXXXXXXXX%0d%0aXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX7d63727970746f7bXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX%0d%0aXXXXXXXXXXXXXXXXXX7d63727970746f7bXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX80b805000000000000">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>63727970746f7bXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX7d63727970746f7bXXXXXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX7d63727970746f7bXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXX7d63727970746f7bXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX80b805000000000000</code></pre>
    
</div>
<p>So we then hash this data and gets its state, let&rsquo;s call it $S_{base}$</p>
<p>Now we create 3 blocks of another message that when its xored with the flag it will produce the same message above, which means the first and the second block will be $0$, then most of the last block will be also $0$, but the last 9 bytes will be different, the last one will be the byte we bruteforce, the other 8 bytes will be values that when xored with &ldquo;}crypto{&rdquo; they will result in the known suffix &ldquo;80b8050000000000&rdquo;.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>data &#43; xor(known_suffix[:8], b&#34;}crypto{&#34;)</code></pre>
    
</div>
<p>Now we can send it, but the MD5 algorithm will pad it again! so it will add another block to the message.</p>
<p>We can use the hash of the first message to calculate the hash of the first message + padding.
We will use the function <code>md5_with_state</code> which recieves the current state and block number and another data to hash.</p>
<p>Then we get</p>
<p>$$
S_1 = H(M_1)
$$
$$
S_2 = H(M_1 + PAD) = H(S_1, PAD)
$$</p>
<p>Because of that we can bruteforce the last byte of the cyclic flag which is the first byte of the flag!
We just calculate locally the hash of the next message plus its padding using the hash of <code>(CYCLIC_FLAG + PAD)</code> ($S_1$)</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%28CYCLIC_FLAG%20&#43;%20PAD%29%20&#43;%20PAD">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>(CYCLIC_FLAG &#43; PAD) &#43; PAD</code></pre>
    
</div>
<p>We send to the program (where B is a random char)</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%28zeros%20&#43;%20%28%22%7dcrypto%7b%22%20xor%20PAD%29%20&#43;%20B%29">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>(zeros &#43; (&#34;}crypto{&#34; xor PAD) &#43; B)</code></pre>
    
</div>
<p>So the program will add another pad to it and it will result to</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%28CYCLIC_FLAG%20&#43;%20PAD%20&#43;%20%28B%20%5e%20last_flag_byte%29%29%20&#43;%20PAD">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>(CYCLIC_FLAG &#43; PAD &#43; (B ^ last_flag_byte)) &#43; PAD</code></pre>
    
</div>
<p>Then we compare the MD5 hashes, if we get that the hashes are equals, we know that
$$
B \oplus flag[-1] = PAD[-1]
$$
So
$$
flag[-1] = PAD[-1] \oplus B
$$</p>
<p>We can use the following method to find the all the flag&rsquo;s bytes.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> itertools <span style="color:#f92672">import</span> cycle
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> math
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rotate_by <span style="color:#f92672">=</span> [<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">22</span>,
</span></span><span style="display:flex;"><span>             <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">20</span>,
</span></span><span style="display:flex;"><span>             <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">23</span>,
</span></span><span style="display:flex;"><span>             <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">21</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>constants <span style="color:#f92672">=</span> [int(abs(math<span style="color:#f92672">.</span>sin(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">4294967296</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">64</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>init_MDBuffer <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x67452301</span>, <span style="color:#ae81ff">0xefcdab89</span>, <span style="color:#ae81ff">0x98badcfe</span>, <span style="color:#ae81ff">0x10325476</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">leftRotate</span>(x, amount):
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">&amp;=</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (x <span style="color:#f92672">&lt;&lt;</span> amount <span style="color:#f92672">|</span> x <span style="color:#f92672">&gt;&gt;</span> (<span style="color:#ae81ff">32</span><span style="color:#f92672">-</span>amount)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_pad_suffix</span>(msg):
</span></span><span style="display:flex;"><span>    d <span style="color:#f92672">=</span> len(msg) <span style="color:#f92672">%</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>    msg_len_in_bits <span style="color:#f92672">=</span> (<span style="color:#ae81ff">8</span><span style="color:#f92672">*</span>len(msg)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffffffffffff</span>
</span></span><span style="display:flex;"><span>    msg <span style="color:#f92672">+=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x80</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(msg)<span style="color:#f92672">%</span><span style="color:#ae81ff">64</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">56</span>:
</span></span><span style="display:flex;"><span>        msg <span style="color:#f92672">+=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    msg <span style="color:#f92672">+=</span> msg_len_in_bits<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">8</span>, byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;little&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> msg[<span style="color:#f92672">-</span><span style="color:#ae81ff">64</span> <span style="color:#f92672">+</span> d:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pad</span>(msg):
</span></span><span style="display:flex;"><span>    msg_len_in_bits <span style="color:#f92672">=</span> (<span style="color:#ae81ff">8</span><span style="color:#f92672">*</span>len(msg)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffffffffffff</span>
</span></span><span style="display:flex;"><span>    msg<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0x80</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(msg)<span style="color:#f92672">%</span><span style="color:#ae81ff">64</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">56</span>:
</span></span><span style="display:flex;"><span>        msg<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    msg <span style="color:#f92672">+=</span> msg_len_in_bits<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">8</span>, byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;little&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> msg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pad_with_len</span>(msg, msg_len):
</span></span><span style="display:flex;"><span>    msg_len_in_bits <span style="color:#f92672">=</span> (<span style="color:#ae81ff">8</span><span style="color:#f92672">*</span>msg_len) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffffffffffff</span>
</span></span><span style="display:flex;"><span>    msg<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0x80</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(msg)<span style="color:#f92672">%</span><span style="color:#ae81ff">64</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">56</span>:
</span></span><span style="display:flex;"><span>        msg<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    msg <span style="color:#f92672">+=</span> msg_len_in_bits<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">8</span>, byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;little&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> msg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">vector_to_hash</span>(init_vector):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sum(buffer_content<span style="color:#f92672">&lt;&lt;</span>(<span style="color:#ae81ff">32</span><span style="color:#f92672">*</span>i) <span style="color:#66d9ef">for</span> i, buffer_content <span style="color:#f92672">in</span> enumerate(init_vector))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">number_to_vector</span>(number):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> list(struct<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#34;&lt;IIII&#34;</span>, number<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">16</span>, <span style="color:#e6db74">&#34;little&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">MD_to_hex</span>(digest):
</span></span><span style="display:flex;"><span>    raw <span style="color:#f92672">=</span> digest<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">16</span>, byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;little&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{:032x}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(int<span style="color:#f92672">.</span>from_bytes(raw, byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;big&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hex_to_MD</span>(h):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> int<span style="color:#f92672">.</span>from_bytes(bytes<span style="color:#f92672">.</span>fromhex(h), <span style="color:#e6db74">&#34;little&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_message_with_state</span>(state, msg):
</span></span><span style="display:flex;"><span>    init_temp <span style="color:#f92672">=</span> state <span style="color:#75715e">#init_MDBuffer[:]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> offset <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(msg), <span style="color:#ae81ff">64</span>):
</span></span><span style="display:flex;"><span>        A, B, C, D <span style="color:#f92672">=</span> init_temp 
</span></span><span style="display:flex;"><span>        block <span style="color:#f92672">=</span> msg[offset : offset<span style="color:#f92672">+</span><span style="color:#ae81ff">64</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">64</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Round 1</span>
</span></span><span style="display:flex;"><span>                func <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> b, c, d: (b <span style="color:#f92672">&amp;</span> c) <span style="color:#f92672">|</span> (<span style="color:#f92672">~</span>b <span style="color:#f92672">&amp;</span> d)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                index_func <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> i: i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">and</span> i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">32</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Round 2</span>
</span></span><span style="display:flex;"><span>                func <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> b, c, d: (d <span style="color:#f92672">&amp;</span> b) <span style="color:#f92672">|</span> (<span style="color:#f92672">~</span>d <span style="color:#f92672">&amp;</span> c)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                index_func <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> i: (<span style="color:#ae81ff">5</span><span style="color:#f92672">*</span>i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">%</span><span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">32</span> <span style="color:#f92672">and</span> i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">48</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Round 3</span>
</span></span><span style="display:flex;"><span>                func <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> b, c, d: b <span style="color:#f92672">^</span> c <span style="color:#f92672">^</span> d
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                index_func <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> i: (<span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>i <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>)<span style="color:#f92672">%</span><span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">48</span> <span style="color:#f92672">and</span> i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">64</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Round 4</span>
</span></span><span style="display:flex;"><span>                func <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> b, c, d: c <span style="color:#f92672">^</span> (b <span style="color:#f92672">|</span> <span style="color:#f92672">~</span>d)
</span></span><span style="display:flex;"><span>                index_func <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> i: (<span style="color:#ae81ff">7</span><span style="color:#f92672">*</span>i)<span style="color:#f92672">%</span><span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            F <span style="color:#f92672">=</span> func(B, C, D) 
</span></span><span style="display:flex;"><span>            G <span style="color:#f92672">=</span> index_func(i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            to_rotate <span style="color:#f92672">=</span> A <span style="color:#f92672">+</span> F <span style="color:#f92672">+</span> constants[i] <span style="color:#f92672">+</span> int<span style="color:#f92672">.</span>from_bytes(block[<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>G : <span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>G <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>], byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;little&#39;</span>)
</span></span><span style="display:flex;"><span>            newB <span style="color:#f92672">=</span> (B <span style="color:#f92672">+</span> leftRotate(to_rotate, rotate_by[i])) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            A, B, C, D <span style="color:#f92672">=</span> D, newB, B, C
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, val <span style="color:#f92672">in</span> enumerate([A, B, C, D]):
</span></span><span style="display:flex;"><span>            init_temp[i] <span style="color:#f92672">+=</span> val
</span></span><span style="display:flex;"><span>            init_temp[i] <span style="color:#f92672">&amp;=</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> vector_to_hash(init_temp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_message</span>(msg):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> process_message_with_state(init_MDBuffer[:], msg)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">md5</span>(msg):
</span></span><span style="display:flex;"><span>    msg <span style="color:#f92672">=</span> bytearray(msg) <span style="color:#75715e"># create a copy of the original message in form of a sequence of integers [0, 256)</span>
</span></span><span style="display:flex;"><span>    msg <span style="color:#f92672">=</span> pad(msg)
</span></span><span style="display:flex;"><span>    processed_msg <span style="color:#f92672">=</span> process_message(msg)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># processed_msg contains the integer value of the hash</span>
</span></span><span style="display:flex;"><span>    message_hash <span style="color:#f92672">=</span> MD_to_hex(processed_msg)
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> msg, message_hash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># added function to md5 from a given state</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">md5_with_state</span>(state, msg, calculated_len):
</span></span><span style="display:flex;"><span>    msg <span style="color:#f92672">=</span> bytearray(msg) <span style="color:#75715e"># create a copy of the original message in form of a sequence of integers [0, 256)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    msg_len <span style="color:#f92672">=</span> calculated_len <span style="color:#f92672">+</span> len(msg)
</span></span><span style="display:flex;"><span>    msg <span style="color:#f92672">=</span> pad_with_len(msg, msg_len)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    num_state <span style="color:#f92672">=</span> hex_to_MD(state)
</span></span><span style="display:flex;"><span>    vector_state <span style="color:#f92672">=</span> number_to_vector(num_state)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    processed_msg <span style="color:#f92672">=</span> process_message_with_state(vector_state, msg)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># processed_msg contains the integer value of the hash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    message_hash <span style="color:#f92672">=</span> MD_to_hex(processed_msg)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> message_hash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Start of the challenge</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;crypto{&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">38</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> FLAG<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>FLAG_LENGTH <span style="color:#f92672">=</span> len(FLAG)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">json_recv</span>(r):
</span></span><span style="display:flex;"><span>    line <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(line<span style="color:#f92672">.</span>decode())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">json_send</span>(r, hsh):
</span></span><span style="display:flex;"><span>    request <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps(hsh)<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>    r<span style="color:#f92672">.</span>sendline(request)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_block</span>(data, block_size, block_index):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cyc <span style="color:#f92672">=</span> cycle(data)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(block_index <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(block_size):
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">+=</span> cyc<span style="color:#f92672">.</span>__next__()<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Used at the start of the program to gain the flag length</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##r = remote(&#39;socket.cryptohack.org&#39;, 13407, level = &#39;debug&#39;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##_ = r.recvline()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##flag_size = 0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##while True:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##    json_send(r, {&#34;option&#34;: &#34;message&#34;, &#34;data&#34;: (b&#34;\x00&#34;*flag_size).hex()})</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##    res = json_recv(r)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##    if &#34;error&#34; in res and res[&#34;error&#34;] == &#34;Bad input&#34;:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##        pass</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##    else:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##        break</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##    flag_size += 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##r.close()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(generate_block(FLAG, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Use the second block to find the last character of it (the first character in the flag)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># crypto{....} ....</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># .....</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># .............}crypto{A</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># also ----------- 0x80 L</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># First find the last byte in the second block</span>
</span></span><span style="display:flex;"><span>block_number <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span> <span style="color:#f92672">*</span> block_number
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">+=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">64</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">9</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>known_suffix <span style="color:#f92672">=</span> get_pad_suffix(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;socket.cryptohack.org&#39;</span>, <span style="color:#ae81ff">13407</span>)<span style="color:#75715e">#, level = &#39;debug&#39;)</span>
</span></span><span style="display:flex;"><span>_ <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>json_send(r, {<span style="color:#e6db74">&#34;option&#34;</span>: <span style="color:#e6db74">&#34;message&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>: data<span style="color:#f92672">.</span>hex()})
</span></span><span style="display:flex;"><span>res_state <span style="color:#f92672">=</span> json_recv(r)[<span style="color:#e6db74">&#34;hash&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pad_data <span style="color:#f92672">=</span> data <span style="color:#f92672">+</span> xor(known_suffix[:<span style="color:#ae81ff">8</span>], <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;}crypto{&#34;</span>) <span style="color:#75715e"># It should produce known suffix</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curr_valid_hash <span style="color:#f92672">=</span> md5_with_state(res_state, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span>, (block_number <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>    curr_bruteforce_data <span style="color:#f92672">=</span> pad_data <span style="color:#f92672">+</span> c<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    json_send(r, {<span style="color:#e6db74">&#34;option&#34;</span>: <span style="color:#e6db74">&#34;message&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>: curr_bruteforce_data<span style="color:#f92672">.</span>hex()})
</span></span><span style="display:flex;"><span>    curr_hash <span style="color:#f92672">=</span> json_recv(r)[<span style="color:#e6db74">&#34;hash&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> curr_hash <span style="color:#f92672">==</span> curr_valid_hash:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>found_char <span style="color:#f92672">=</span> (known_suffix[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">^</span> c)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Find the other bytes in iterable way</span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;socket.cryptohack.org&#39;</span>, <span style="color:#ae81ff">13407</span>)
</span></span><span style="display:flex;"><span>_ <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;}crypto{&#34;</span> <span style="color:#f92672">+</span> found_char
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(s)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">38</span>):
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span> <span style="color:#f92672">*</span> block_number
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">+=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">64</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">-</span> i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    known_suffix <span style="color:#f92672">=</span> get_pad_suffix(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    json_send(r, {<span style="color:#e6db74">&#34;option&#34;</span>: <span style="color:#e6db74">&#34;message&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>: data<span style="color:#f92672">.</span>hex()})
</span></span><span style="display:flex;"><span>    res_state <span style="color:#f92672">=</span> json_recv(r)[<span style="color:#e6db74">&#34;hash&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    pad_data <span style="color:#f92672">=</span> data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    curr_valid_hash <span style="color:#f92672">=</span> md5_with_state(res_state, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span>, (block_number <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>        curr_bruteforce_data <span style="color:#f92672">=</span> pad_data <span style="color:#f92672">+</span> c<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>) <span style="color:#f92672">+</span> xor(known_suffix[<span style="color:#ae81ff">1</span>:], s)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        json_send(r, {<span style="color:#e6db74">&#34;option&#34;</span>: <span style="color:#e6db74">&#34;message&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>: curr_bruteforce_data<span style="color:#f92672">.</span>hex()})
</span></span><span style="display:flex;"><span>        curr_hash <span style="color:#f92672">=</span> json_recv(r)[<span style="color:#e6db74">&#34;hash&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> curr_hash <span style="color:#f92672">==</span> curr_valid_hash:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;BAD&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    found_char <span style="color:#f92672">=</span> (known_suffix[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">^</span> c)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    s <span style="color:#f92672">=</span> found_char <span style="color:#f92672">+</span> s
</span></span><span style="display:flex;"><span>    print(s)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>close()</span></span></code></pre></div>
    
</div>
<p><a href="/cryptohack/hashes/code/mdflag.py">mdflag.py</a></p>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>All Rights Reserved ®.</li>
            

            
                <li>yoavshah</li>
            

            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            
                <li>
                    
                        Word Count:
                        1759
                    
                </li>
            

            
            

            
                <li>en</li>
            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.125.3</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            May 10 2024 00:00:00
                        </time>
                    
                </li>
            

            
                <li title="">
                    
                </li>
            
        </ul>
    </div>
</footer>

    </body>

    























    
    


    
    


    <script
        type="text/javascript"
        src="/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js"
        integrity="sha512-XusSDxbqFGNSclxCA2T4e&#43;/q1F9ngUK48P&#43;&#43;8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script>














<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
