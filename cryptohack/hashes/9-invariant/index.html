<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.125.3">

    

    

    
        
            <meta
                name="description"
                content="This is my new hugo site" />
        

        
            <meta
                name="keywords"
                content="security,cryptohack,writeups,cyber" />
        

        
            <meta
                name="author"
                content="yoavshah" />
        

    


    <title>
        
            9-invariant |
            SecurityBlog
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
        


        
        


        <link
            rel="stylesheet"
            href="/css/index_d751713.min.912d03bce61461ecbc3ca083479e1ed814bba94df76d0bdc6aa88fdca33621b9bb410dc2c81af31e8101fec62decfa5f6e48901ad673bc5056d2f1d1f2368a34.css"
            integrity="sha512-kS0DvOYUYey8PKCDR54e2BS7qU33bQvcaqiP3KM2Ibm7QQ3CyBrzHoEB/sYt7PpfbkiQGtZzvFBW0vHR8jaKNA==" />
    


    
    

    

    

    


    
		
        

            




    
        
    




<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
    crossorigin="anonymous" />


<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
    crossorigin="anonymous"></script>


<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
    crossorigin="anonymous"
    
        onload="renderMathInElement(document.body , { trust: true });"
    ></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            
            
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true },
            ],
            
            throwOnError: false,

            
                trust: true
            
        });
    });
</script>

        

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            9-invariant -
            SecurityBlog
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> Cryptohack </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> diffie-helman </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> hashes </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/1-collider/" title="./cryptohack/hashes/1-collider/">
                        
                            1-collider
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/2-hash_stuffing/" title="./cryptohack/hashes/2-hash_stuffing/">
                        
                            2-hash_stuffing
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/3-primed5/" title="./cryptohack/hashes/3-primed5/">
                        
                            3-PriMeD5
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/4-twin_keys/" title="./cryptohack/hashes/4-twin_keys/">
                        
                            4-twin_keys
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/5-no_difference/" title="./cryptohack/hashes/5-no_difference/">
                        
                            5-no_difference
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/6-md0/" title="./cryptohack/hashes/6-md0/">
                        
                            6-md0
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/7-mdflag/" title="./cryptohack/hashes/7-mdflag/">
                        
                            7-mdflag
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/8-mixed_up/" title="./cryptohack/hashes/8-mixed_up/">
                        
                            8-mixed_up
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/hashes/9-invariant/" title="./cryptohack/hashes/9-invariant/">
                        
                            9-invariant
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> symmetric </span>

                    



    
    

    
    

    

    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/01-passwords_as_keys/" title="./cryptohack/symmetric/01-passwords_as_keys/">
                        
                            01-passwords_as_keys
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/02-ecbcbcwtf/" title="./cryptohack/symmetric/02-ecbcbcwtf/">
                        
                            02-ecbcbcwtf
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/03-ecb_oracle/" title="./cryptohack/symmetric/03-ecb_oracle/">
                        
                            03-ecb_oracle
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/04-flipping_cookie/" title="./cryptohack/symmetric/04-flipping_cookie/">
                        
                            04-flipping_cookie
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/05-lazy_cbc/" title="./cryptohack/symmetric/05-lazy_cbc/">
                        
                            05-lazy_cbc
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/06-triple_des/" title="./cryptohack/symmetric/06-triple_des/">
                        
                            06-triple_des
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/07-symmetry/" title="./cryptohack/symmetric/07-symmetry/">
                        
                            07-symmetry
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/08-bean_counter/" title="./cryptohack/symmetric/08-bean_counter/">
                        
                            08-bean_counter
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/09-ctrime/" title="./cryptohack/symmetric/09-ctrime/">
                        
                            09-ctrime
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/10-logon_zero/" title="./cryptohack/symmetric/10-logon_zero/">
                        
                            10-logon_zero
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/11-stream_consciousness/" title="./cryptohack/symmetric/11-stream_consciousness/">
                        
                            11-stream_consciousness
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/12-dancing_queen/" title="./cryptohack/symmetric/12-dancing_queen/">
                        
                            12-dancing_queen
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/13-oh-snap/" title="./cryptohack/symmetric/13-oh-snap/">
                        
                            13-oh-snap
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/14-paper_plane/" title="./cryptohack/symmetric/14-paper_plane/">
                        
                            14-paper_plane
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/15-forbidden_fruit/" title="./cryptohack/symmetric/15-forbidden_fruit/">
                        
                            15-forbidden_fruit
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://yoavshah.github.io/cryptohack/symmetric/16-beatboxer/" title="./cryptohack/symmetric/16-beatboxer/">
                        
                            16-beatboxer
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                9-invariant
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/yoavshah/"
                                class="cat-btn">
                                yoavshah
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="2024.05.10"
                            >2024.05.10
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        7 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    
    
    




<a href="https://yoavshah.github.io/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="https://yoavshah.github.io/cryptohack/" class="bread-btn">
    

    
        Cryptohack
    
</a>




    /



<a href="https://yoavshah.github.io/cryptohack/hashes/" class="bread-btn">
    

    
        hashes
    
</a>




    /



<a href="https://yoavshah.github.io/cryptohack/hashes/9-invariant/" class="bread-btn">
    

    
        
            9-invariant
        

    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents"></nav>
        


        <div class="content">
            
                <h1 id="challenge">Challenge</h1>
<p>In this challenge we get another custom hash function, this time we need to find the data that makes this hash produce zero block.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> itertools
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> sha512
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;crypto{????????????????????????????????}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyCipher</span>:
</span></span><span style="display:flex;"><span>    __NR <span style="color:#f92672">=</span> <span style="color:#ae81ff">31</span>
</span></span><span style="display:flex;"><span>    __SB <span style="color:#f92672">=</span> [<span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span>    __SR <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">11</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, key):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>__RK <span style="color:#f92672">=</span> int(key<span style="color:#f92672">.</span>hex(), <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>__subkeys <span style="color:#f92672">=</span> [[(self<span style="color:#f92672">.</span>__RK <span style="color:#f92672">&gt;&gt;</span> (<span style="color:#ae81ff">16</span> <span style="color:#f92672">*</span> j <span style="color:#f92672">+</span> i)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>)]
</span></span><span style="display:flex;"><span>                          <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>__NR <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>KEYS <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__subkeys
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__xorAll</span>(self, v):
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> v:
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">^=</span> x
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encrypt</span>(self, plaintext):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> len(plaintext) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;Error: the plaintext must contains 64 bits.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        S <span style="color:#f92672">=</span> [int(_, <span style="color:#ae81ff">16</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> list(plaintext<span style="color:#f92672">.</span>hex())]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>__NR):
</span></span><span style="display:flex;"><span>            S <span style="color:#f92672">=</span> [S[i] <span style="color:#f92672">^</span> self<span style="color:#f92672">.</span>__subkeys[r][i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>)]
</span></span><span style="display:flex;"><span>            S <span style="color:#f92672">=</span> [self<span style="color:#f92672">.</span>__SB[S[self<span style="color:#f92672">.</span>__SR[i]]] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>)]
</span></span><span style="display:flex;"><span>            X <span style="color:#f92672">=</span> [self<span style="color:#f92672">.</span>__xorAll(S[i:i <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>]) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>            S <span style="color:#f92672">=</span> [X[c] <span style="color:#f92672">^</span> S[<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> c <span style="color:#f92672">+</span> r]
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">for</span> c, r <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>product(range(<span style="color:#ae81ff">4</span>), range(<span style="color:#ae81ff">4</span>))]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        S <span style="color:#f92672">=</span> [S[i] <span style="color:#f92672">^</span> self<span style="color:#f92672">.</span>__subkeys[self<span style="color:#f92672">.</span>__NR][i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{:x}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(_) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> S))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyHash</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, content):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cipher <span style="color:#f92672">=</span> MyCipher(sha512(content)<span style="color:#f92672">.</span>digest())
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_update(content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_update</span>(self, content):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> len(content) <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            content <span style="color:#f92672">+=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(content), <span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> bytes(x <span style="color:#f92672">^</span> y <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(self<span style="color:#f92672">.</span>h, content[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>]))
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cipher<span style="color:#f92672">.</span>encrypt(self<span style="color:#f92672">.</span>h)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> bytes(x <span style="color:#f92672">^</span> y <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(self<span style="color:#f92672">.</span>h, content[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">digest</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hexdigest</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>h<span style="color:#f92672">.</span>hex()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> comb <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>product([<span style="color:#ae81ff">0x66</span>, <span style="color:#ae81ff">0x67</span>, <span style="color:#ae81ff">0x76</span>, <span style="color:#ae81ff">0x77</span>], repeat<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>):
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join([x<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> comb])
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> MyHash(data)<span style="color:#f92672">.</span>digest()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> h <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Found combination&#34;</span>)
</span></span><span style="display:flex;"><span>        print(comb)
</span></span><span style="display:flex;"><span>        print(data)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> i <span style="color:#f92672">%</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        print(str(i) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> h<span style="color:#f92672">.</span>hex())
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Challenge</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>counter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>before_input <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Can you cryptanalyse this cryptohash?</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>exit <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hash</span>(self, data):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>counter <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> MyHash(data)<span style="color:#f92672">.</span>digest()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">challenge</span>(self, your_input):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;option&#39;</span> <span style="color:#f92672">in</span> your_input:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;You must send an option to this server&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> your_input[<span style="color:#e6db74">&#39;option&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;hash&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">assert</span> <span style="color:#e6db74">&#39;data&#39;</span> <span style="color:#f92672">in</span> your_input
</span></span><span style="display:flex;"><span>                data <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(your_input[<span style="color:#e6db74">&#34;data&#34;</span>])
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">assert</span> len(data) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">AssertionError</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;You must send hex data to be hashed&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            h <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>hash(data)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> h <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;hash&#34;</span>: h<span style="color:#f92672">.</span>hex(), <span style="color:#e6db74">&#34;info&#34;</span>: <span style="color:#e6db74">&#34;Congratulations!&#34;</span>, <span style="color:#e6db74">&#34;flag&#34;</span>: FLAG}
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> h[:<span style="color:#ae81ff">7</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">7</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;hash&#34;</span>: h<span style="color:#f92672">.</span>hex(), <span style="color:#e6db74">&#34;info&#34;</span>: <span style="color:#e6db74">&#34;You are so close!&#34;</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> h[:<span style="color:#ae81ff">6</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">6</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;hash&#34;</span>: h<span style="color:#f92672">.</span>hex(), <span style="color:#e6db74">&#34;info&#34;</span>: <span style="color:#e6db74">&#34;Almost there!&#34;</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> h[:<span style="color:#ae81ff">5</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;hash&#34;</span>: h<span style="color:#f92672">.</span>hex(), <span style="color:#e6db74">&#34;info&#34;</span>: <span style="color:#e6db74">&#34;This was easy, right?&#34;</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;hash&#34;</span>: h<span style="color:#f92672">.</span>hex()}</span></span></code></pre></div>
    
</div>
<h1 id="solution">Solution</h1>
<p>The weakness in this challenge is in the cipher that used in the hashing.
In the key schedule we use 512 bits to create 32 keys, each key in the size of 8, but! each key contains only ones and zeros!
In the encryption method we can see that those keys are used in the xor operation for againts each 4 bits of the state (0 to 16 values).</p>
<p>Okay nice, so we can understand from this that the key is responsible to transfer 0-1, 2-3, 4-5, 6-7, 8-9, 10-11, 12-13, 14-15 (because that&rsquo;s a xor with the number 1 or 0).</p>
<p>Now let&rsquo;s have a look on the SBOX</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="__SB%20=%20[13,%2014,%200,%201,%205,%2010,%207,%206,%2011,%203,%209,%2012,%2015,%208,%202,%204]">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>__SB = [13, 14, 0, 1, 5, 10, 7, 6, 11, 3, 9, 12, 15, 8, 2, 4]</code></pre>
    
</div>
<p>Let&rsquo;s try and process it, find some tuples inside it</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>passed <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> i <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> passed:
</span></span><span style="display:flex;"><span>	passed<span style="color:#f92672">.</span>append(i)
</span></span><span style="display:flex;"><span>	i <span style="color:#f92672">=</span> __SB[i]</span></span></code></pre></div>
    
</div>
<p>We will get here</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="[0,%2013,%208,%2011,%2012,%2015,%204,%205,%2010,%209,%203,%201,%2014,%202]">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>[0, 13, 8, 11, 12, 15, 4, 5, 10, 9, 3, 1, 14, 2]</code></pre>
    
</div>
<p>We can see there are 2 missing numbers here, 6 and 7.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>passed <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> i <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> passed:
</span></span><span style="display:flex;"><span>	passed<span style="color:#f92672">.</span>append(i)
</span></span><span style="display:flex;"><span>	i <span style="color:#f92672">=</span> __SB[i]</span></span></code></pre></div>
    
</div>
<p>Now we will get</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="[6,%207]">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>[6, 7]</code></pre>
    
</div>
<p>So we can understand that the SBOX transfers from 6 to 7 and vice versa.</p>
<p>Now let&rsquo;s have a look at the permutation in the code</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="__SR%20=%20[0,%205,%2010,%2015,%204,%209,%2014,%203,%208,%2013,%202,%207,%2012,%201,%206,%2011]">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>__SR = [0, 5, 10, 15, 4, 9, 14, 3, 8, 13, 2, 7, 12, 1, 6, 11]</code></pre>
    
</div>
<p>All it does is just moving bytes in the state from one place to another, nothing we can get here.</p>
<p>The last step is the combination xor</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>X <span style="color:#f92672">=</span> [self<span style="color:#f92672">.</span>__xorAll(S[i:i <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>]) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>S <span style="color:#f92672">=</span> [X[c] <span style="color:#f92672">^</span> S[<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> c <span style="color:#f92672">+</span> r]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> c, r <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>product(range(<span style="color:#ae81ff">4</span>), range(<span style="color:#ae81ff">4</span>))]</span></span></code></pre></div>
    
</div>
<p>This code actualy groups 4 state bytes together and xor them in this way (and it iterates for each group)</p>
<p>$$
Perm(S)[0] = S[1] \oplus S[2] \oplus S[3]
Perm(S)[1] = S[0] \oplus S[2] \oplus S[3]
Perm(S)[2] = S[0] \oplus S[1] \oplus S[3]
Perm(S)[3] = S[0] \oplus S[1] \oplus S[2]
$$</p>
<p>Image we have control over the state and set all the numbers to &lsquo;6&rsquo; or &lsquo;7&rsquo;, then the xor operation in the equations above will also result in &lsquo;6&rsquo; or &lsquo;7&rsquo;!</p>
<p>So we can conclude that a plaintext containing only the following bytes</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="[0x66,%200x67,%200x76,%200x77]">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>[0x66, 0x67, 0x76, 0x77]</code></pre>
    
</div>
<p>Will always result in a ciphertext containing those bytes only!</p>
<p>Because we need the overall hash to be zero, we actually need that the update function will result in zero</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(content), <span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> bytes(x <span style="color:#f92672">^</span> y <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(self<span style="color:#f92672">.</span>h, content[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>]))
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cipher<span style="color:#f92672">.</span>encrypt(self<span style="color:#f92672">.</span>h)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> bytes(x <span style="color:#f92672">^</span> y <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(self<span style="color:#f92672">.</span>h, content[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>]))</span></span></code></pre></div>
    
</div>
<p>As we can see if we want the first block to make the hash zero, we need that
$$
0 = E(B0, K) \oplus B0 \Rightarrow E(B0, K) = B0
$$
or that
$$
0 = E(B1 \oplus B0 \oplus E(B0, K), K) \oplus B1 \Rightarrow B1 = E(B1 \oplus B0 \oplus E(B0, K), K)
$$</p>
<p>etc&hellip;</p>
<p>In all cases we have much more probabillity to get 0 in the hash when we send data that contains only the following bytes</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="[0x66,%200x67,%200x76,%200x77]">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>[0x66, 0x67, 0x76, 0x77]</code></pre>
    
</div>
<p>So we will bruteforce blocks until we find data that its hash is zero.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>block_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> block_size <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>    found <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> comb <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>product([<span style="color:#ae81ff">0x66</span>, <span style="color:#ae81ff">0x67</span>, <span style="color:#ae81ff">0x76</span>, <span style="color:#ae81ff">0x77</span>], repeat<span style="color:#f92672">=</span>block_size):
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join([x<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> comb])
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> MyHash(data)<span style="color:#f92672">.</span>digest()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> h <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            found <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Found combination&#34;</span>)
</span></span><span style="display:flex;"><span>            print(comb)
</span></span><span style="display:flex;"><span>            print(data)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> found:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span></span></span></code></pre></div>
    
</div>
<p>Then we will send it and get the flag</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> itertools
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> sha512
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;crypto{????????????????????????????????}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyCipher</span>:
</span></span><span style="display:flex;"><span>    __NR <span style="color:#f92672">=</span> <span style="color:#ae81ff">31</span>
</span></span><span style="display:flex;"><span>    __SB <span style="color:#f92672">=</span> [<span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span>    __SR <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">11</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, key):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>__RK <span style="color:#f92672">=</span> int(key<span style="color:#f92672">.</span>hex(), <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>__subkeys <span style="color:#f92672">=</span> [[(self<span style="color:#f92672">.</span>__RK <span style="color:#f92672">&gt;&gt;</span> (<span style="color:#ae81ff">16</span> <span style="color:#f92672">*</span> j <span style="color:#f92672">+</span> i)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>)]
</span></span><span style="display:flex;"><span>                          <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>__NR <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>KEYS <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__subkeys
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__xorAll</span>(self, v):
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> v:
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">^=</span> x
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encrypt</span>(self, plaintext):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> len(plaintext) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;Error: the plaintext must contains 64 bits.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        S <span style="color:#f92672">=</span> [int(_, <span style="color:#ae81ff">16</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> list(plaintext<span style="color:#f92672">.</span>hex())]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>__NR):
</span></span><span style="display:flex;"><span>            S <span style="color:#f92672">=</span> [S[i] <span style="color:#f92672">^</span> self<span style="color:#f92672">.</span>__subkeys[r][i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>)]
</span></span><span style="display:flex;"><span>            S <span style="color:#f92672">=</span> [self<span style="color:#f92672">.</span>__SB[S[self<span style="color:#f92672">.</span>__SR[i]]] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>)]
</span></span><span style="display:flex;"><span>            X <span style="color:#f92672">=</span> [self<span style="color:#f92672">.</span>__xorAll(S[i:i <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>]) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>            S <span style="color:#f92672">=</span> [X[c] <span style="color:#f92672">^</span> S[<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> c <span style="color:#f92672">+</span> r]
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">for</span> c, r <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>product(range(<span style="color:#ae81ff">4</span>), range(<span style="color:#ae81ff">4</span>))]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        S <span style="color:#f92672">=</span> [S[i] <span style="color:#f92672">^</span> self<span style="color:#f92672">.</span>__subkeys[self<span style="color:#f92672">.</span>__NR][i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{:x}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(_) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> S))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyHash</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, content):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cipher <span style="color:#f92672">=</span> MyCipher(sha512(content)<span style="color:#f92672">.</span>digest())
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_update(content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_update</span>(self, content):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> len(content) <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            content <span style="color:#f92672">+=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(content), <span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> bytes(x <span style="color:#f92672">^</span> y <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(self<span style="color:#f92672">.</span>h, content[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>]))
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cipher<span style="color:#f92672">.</span>encrypt(self<span style="color:#f92672">.</span>h)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>h <span style="color:#f92672">=</span> bytes(x <span style="color:#f92672">^</span> y <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(self<span style="color:#f92672">.</span>h, content[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">digest</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hexdigest</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>h<span style="color:#f92672">.</span>hex()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>block_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> block_size <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>    found <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> comb <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>product([<span style="color:#ae81ff">0x66</span>, <span style="color:#ae81ff">0x67</span>, <span style="color:#ae81ff">0x76</span>, <span style="color:#ae81ff">0x77</span>], repeat<span style="color:#f92672">=</span>block_size):
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join([x<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;little&#34;</span>) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> comb])
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> MyHash(data)<span style="color:#f92672">.</span>digest()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> h <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            found <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Found combination&#34;</span>)
</span></span><span style="display:flex;"><span>            print(comb)
</span></span><span style="display:flex;"><span>            print(data)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> found:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;socket.cryptohack.org&#39;</span>, <span style="color:#ae81ff">13393</span>)<span style="color:#75715e">#, level = &#39;debug&#39;)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>_ <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">json_recv</span>():
</span></span><span style="display:flex;"><span>    line <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(line<span style="color:#f92672">.</span>decode())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">json_send</span>(hsh):
</span></span><span style="display:flex;"><span>    request <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps(hsh)<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>    r<span style="color:#f92672">.</span>sendline(request)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>json_send({<span style="color:#e6db74">&#34;option&#34;</span>: <span style="color:#e6db74">&#34;hash&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>: data<span style="color:#f92672">.</span>hex()})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> json_recv()[<span style="color:#e6db74">&#34;flag&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(flag)</span></span></code></pre></div>
    
</div>
<p><a href="/cryptohack/hashes/code/invariant.py">invariant.py</a></p>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>All Rights Reserved ®.</li>
            

            
                <li>yoavshah</li>
            

            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            
                <li>
                    
                        Word Count:
                        1398
                    
                </li>
            

            
            

            
                <li>en</li>
            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.125.3</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            May 10 2024 00:00:00
                        </time>
                    
                </li>
            

            
                <li title="">
                    
                </li>
            
        </ul>
    </div>
</footer>

    </body>

    























    
    


    
    


    <script
        type="text/javascript"
        src="/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js"
        integrity="sha512-XusSDxbqFGNSclxCA2T4e&#43;/q1F9ngUK48P&#43;&#43;8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script>














<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
